!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?a.trilyo=b():"object"==typeof exports?exports.trilyo=b():a.trilyo=b()}(window,function(){function a(a){if(!document.getElementById("trilyo-f-tl")){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("div");b.id="trilyo-f-tl",c.id="trilyo-f-tr",d.id="trilyo-f-bl",e.id="trilyo-f-br",g.id="trilyo-ab-center",h.id="trilyo-f-left",i.id="trilyo-f-right",f.id="trilyo-f-full",j.id="trilyo-f-topBar",k.id="trilyo-f-bottomBar",a.appendChild(b),a.appendChild(c),a.appendChild(d),a.appendChild(e),a.appendChild(f),a.appendChild(h),f.append(g),a.appendChild(i),a.appendChild(j),a.appendChild(k)}}function b(a){this.modal=a,this.idleTime=0,this.visitTime=0,this.visitTimeout=0;var b=this;this.timerIncrement=function(){this.idleTime<3600&&(this.idleTime=this.idleTime+1),this.visitTime<3600?this.visitTime=this.visitTime+1:clearInterval(this.interval),this.idelTimeout&&this.idleTime>this.idelTimeout&&(clearInterval(this.interval),b.modal.open()),void 0!==this.waitFor&&this.waitFor>-1&&this.visitTime>this.waitFor&&(clearInterval(this.interval),b.modal.open())},this.interval=setInterval(function(){b.timerIncrement()},1e3)}function c(a){return/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(a.navigator.userAgent||a.navigator.vendor||a.opera)}function d(a){var b={onClose:null,onOpen:null,beforeOpen:null,beforeClose:null,onClick:null,stickyFooter:!1,footer:!1,cssClass:[],closeLabel:"Close",closeMethods:["button","escape"]};this.opts=o({},b,a),this.init()}function e(a,b){for(var c=a.querySelectorAll("input:checked"),d=c.length,e=[],f=0;f<d;f++)"on"==c[f].value?e.push(c[f].parentNode.innerHTML.replace(c[f].outerHTML,"")):e.push(c[f].value||c[f].parentNode.innerHTML);return c[0]&&"radio"==c[0].type?e[0]:e}function f(){this.modalBoxFooter&&(this.modalBoxFooter.style.width=this.modalBox.clientWidth+"px",this.modalBoxFooter.style.left=this.modalBox.offsetLeft+"px")}function g(){if(a(document.querySelector(this.opts.wrapper)||document.body),this.modalBox=document.createElement("div"),this.modalBox.className="trilyo-modal-box",this.modalBoxContent=document.createElement("div"),this.modalBoxContent.classList.add("trilyo-modal-box__content"),this.opts.override){if(this.opts.override.self)for(var b in this.opts.override.self)this.modalBox.style[b]=this.opts.override.self[b];if(this.opts.override.content)for(var b in this.opts.override.content)this.modalBoxContent.style[b]=this.opts.override.content[b]}this.opts.closeMethods.indexOf("button")>-1&&(this.modalBoxClose=document.createElement("img"),this.modalBoxClose.classList.add("trilyo-modal-box__close"),this.opts.closeMethods.indexOf("white")>-1?this.modalBoxClose.setAttribute("src","https://chat.trilyo.com/svg/close_w.svg"):this.modalBoxClose.setAttribute("src","https://content.trilyo.com/script-assets/close.svg"),this.modalBox.appendChild(this.modalBoxClose)),this.modalBoxShare=document.createElement("img"),this.modalBoxShare.classList.add("trilyo-modal-box__share"),void 0!==this.opts.shareClass?(this.modalBoxShare.classList.add(this.opts.shareClass[0]),this.modalBoxShare.setAttribute("src","https://chat.trilyo.com/images/share.png")):this.modalBoxShare.setAttribute("src","https://chat.trilyo.com/images/share.png"),this.opts.share&&this.modalBox.appendChild(this.modalBoxShare),this.modalBox.appendChild(this.modalBoxContent),-1!==this.opts.closeMethods.indexOf("button")&&this.modalBox.appendChild(this.modalBoxClose),document.getElementById(this.opts.parent).appendChild(this.modalBox),("trilyo-f-left"==this.opts.parent||"trilyo-f-right"==this.opts.parent||this.opts.hasChevron)&&(this.modalBox.style.borderTopRightRadius="0px",this.modalOpenBtn=document.createElement("div"),this.modalOpenBtn.classList.add("trilyo-open-btn"),this.opts.animation.indexOf("Up")>-1&&(this.modalOpenBtn.classList.add("trilyo-open-btn-up"),"trilyo-f-bl"==this.opts.parent?(this.modalBox.classList.add("trilyo-attached-to-left"),document.getElementById("trilyo-f-bl").style.left="0px",document.getElementById("trilyo-f-bl").style.bottom="0px"):"trilyo-f-br"==this.opts.parent&&(this.modalBox.classList.add("trilyo-attached-to-right"),document.getElementById("trilyo-f-br").style.left="0px",document.getElementById("trilyo-f-br").style.bottom="0px")),this.opts.animation.indexOf("Down")>-1&&(this.modalOpenBtn.classList.add("trilyo-open-btn-down"),"trilyo-f-bl"==this.opts.parent?this.modalBox.classList.add("trilyo-attached-to-left"):"trilyo-f-br"==this.opts.parent&&this.modalBox.classList.add("trilyo-attached-to-right")),this.modalOpenBtn.style.animationDuration=this.opts.animationDuration,this.opts.chevronColor&&(this.modalOpenBtn.style.backgroundColor=this.opts.chevronColor),document.getElementById(this.opts.parent).appendChild(this.modalOpenBtn))}function h(){this.modalBoxFooter=document.createElement("div"),this.modalBoxFooter.classList.add("trilyo-modal-box__footer"),this.modalBox.appendChild(this.modalBoxFooter),this.opts.showPower&&(this.modalBoxFooter.innerHTML+='<div class="pwrdbytrilyo" style="position: absolute;bottom: 3px;"><a href="https://www.trilyo.com" title="Direct booking booster" style="font-size: 12px;text-decoration: none;color: #808080;">Powered by Trilyo</a></div>')}function j(){if(this._events={clickCloseBtn:this.close.bind(this),clickOverlay:l.bind(this),resize:this.checkOverflow.bind(this),keyboardNav:k.bind(this)},-1!==this.opts.closeMethods.indexOf("button")){var a=this;this.modalBoxClose.addEventListener("click",function(b){b.stopPropagation(),a.close()})}if(this.modalOpenBtn){var a=this;this.modalOpenBtn.addEventListener("click",function(b){b.stopPropagation(),a.isOpen()?(console.log("ClOSING"),a.close()):(console.log("OPENING"),a.open(!0))})}this.modalBoxShare.addEventListener("click",function(a){self.close()}),this.opts.onClick&&this.modal.addEventListener("click",function(a){if("function"==typeof self.opts.onClick){this.opts.onClick.call(this)}}),window.addEventListener("resize",this._events.resize),document.addEventListener("keydown",this._events.keyboardNav)}function k(a){-1!==this.opts.closeMethods.indexOf("escape")&&27===a.which&&this.isOpen()&&this.close(),-1!==this.opts.parent.indexOf("trilyo-ab-")&&27===a.which&&this.isOpen()&&this.close()}function l(a){console.log("ALERT",this.opts.closeMethods.indexOf("overlay"),!m(a.target,"trilyo-modal-box")),-1===this.opts.closeMethods.indexOf("overlay")||m(a.target,"trilyo-modal-box")||(console.log("CLOSING",this),this.close())}function m(a,b){for(;(a=a.parentElement)&&!a.classList.contains(b););return a}function n(){-1!==this.opts.closeMethods.indexOf("button")&&this.modalBoxClose.removeEventListener("click",this._events.clickCloseBtn),this.modal.removeEventListener("mousedown",this._events.clickOverlay),window.removeEventListener("resize",this._events.resize),document.removeEventListener("keydown",this._events.keyboardNav)}function o(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}function p(){var a,b=document.createElement("trilyo-test-transition"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}p();b.prototype.addTrigger=function(a,b){var d=this;switch(a.toLowerCase()){case"exit":if(b.waitForSeconds&&(this.visitTimeout=b.waitForSeconds),document.addEventListener("mouseout",function(a){a=a||window.event,a.relatedTarget||a.toElement||d.visitTime>d.visitTimeout&&(console.log("self.visitTime, self.visitTimeout",d.visitTime,d.visitTimeout),d.modal.open())}),c(window)){var e=location.hash,f=!1;window.location.hash?(window.history.pushState(null,"1",location.hash),window.onpopstate=function(){window.location.hash!=e||f||(d.modal.open(),f=!0)}):(window.history.pushState(null,"1","#trilyo"),window.onhashchange=function(){location.hash==e&&(d.modal.open(),f=!0)});var g=Math.abs(document.body.clientHeight-window.height),h=0;window.addEventListener("scroll",function(a){document.documentElement.scrollTop>g/2&&(h||(h=document.documentElement.scrollTop)),h&&document.documentElement.scrollTop<h-.05*document.body.clientHeight&&d.modal.open()})}break;case"scroll":window.addEventListener("scroll",function(a){if(b)if(b.top){if(document.documentElement.scrollTop>b.top)return void d.modal.open()}else if(b.element&&document.getElementById(b.element).getBoundingClientRect().top<=0)return void d.modal.open()});break;case"idle":b.timeout&&(this.idelTimeout=b.timeout),document.addEventListener("mousemove",function(a){d.idleTime=0}),document.addEventListener("keydown",function(a){d.idleTime=0});break;case"timeout":if(void 0!==b.waitForSeconds)return this.waitFor=b.waitForSeconds,void d.modal.opts.campaign.category;if(void 0!==b.timeout)return this.waitFor=b.timeout,void d.modal.opts.campaign.category;break;case"always":d.modal.open()}},d.prototype.init=function(){this.modal||(g.call(this),j.call(this))},d.prototype.destroy=function(){null!==this.modal&&(n.call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},d.prototype.open=function(a){function b(){if("function"==typeof d.opts.beforeOpen){if(!d.opts.beforeOpen(d.opts.campaign))return}if(d.modalBox.style.removeProperty?d.modalBox.style.removeProperty("display"):d.modalBox.style.removeAttribute("display"),d.modalBox.classList.add("trilyo-modal-box--visible"),d.opts.parent.indexOf("trilyo-ab-")>-1&&(document.getElementById("trilyo-f-full").classList.add("trilyo-modal-box--visible"),document.getElementById("trilyo-f-full").addEventListener("mousedown",d._events.clickOverlay)),d.modalBox.classList.add("animated"),d.modalBox.style.animationDuration=d.opts.animationDuration||"1s","function"==typeof d.opts.onOpen&&d.opts.onOpen(d),d.opts.animation&&d.modalBox.classList.add(d.opts.animation),d.modalOpenBtn){if(d.modalOpenBtn.classList.add(d.opts.animation.replace(/slide/gi,"move")),d.modalOpenBtn.classList.add("animated"),d.opts.animation.indexOf("Up")>-1)document.getElementById(d.opts.parent).style.width=d.modalBox.clientWidth+"px";else{var a=d.modalBox.clientHeight;document.getElementById(d.opts.parent).style.height=a+"px",d.modalBox.style.minHeight=a+"px",d.modalBox.style.padding="0px"}d.modalOpenBtn.classList.add("trilyo-btn--visible")}}var c,d=this,e=document,f=function(){var d=!1;return(e.querySelector(".trilyo-modal-box--visible")||e.querySelector(".trilyo-nudge-fadeIn"))&&(d=!e.querySelector(".trilyo-modal-box--visible .trilyo-information")||1!=e.querySelectorAll(".trilyo-modal-box--visible").length),!(d&&!a)&&(b(),c&&clearInterval(c),!0)};!d.opts.campaign||"make-announcement"!=d.opts.campaign.category&&"get-agreement"!=d.opts.campaign.category&&"push-desktop"!=d.opts.campaign.category&&"price-parity"!=d.opts.campaign.category?f()||setInterval(function(){f()},5e3):b()},d.prototype.isOpen=function(){return!!this.modalBox.classList.contains("trilyo-modal-box--visible")},d.prototype.close=function(a){if("function"==typeof this.opts.beforeClose){if(!this.opts.beforeClose.call(this))return}if(this.opts.animation){var b=this.opts.animation;exitAnimation=b.replace(/In/,"Out"),b.indexOf("Up")>-1?exitAnimation=exitAnimation.replace(/Up/,"Down"):exitAnimation=exitAnimation.replace(/Down/,"Up"),this.modalBox.classList.remove(b),this.modalBox.classList.add(exitAnimation);var c=this;c.modalOpenBtn&&(c.modalOpenBtn.classList.remove(b.replace("slide","move")),c.modalOpenBtn.classList.add(exitAnimation.replace("slide","move")),c.modalOpenBtn.classList.add("animated")),setTimeout(function(){c.opts.parent.indexOf("trilyo-ab-")>-1&&c.modalBox.className.indexOf("trilyo-modal-box--visible")>-1&&(document.getElementById("trilyo-f-full").classList.remove("trilyo-modal-box--visible"),document.getElementById("trilyo-f-full").removeEventListener("mousedown",c._events.clickOverlay)),c.modalBox.classList.remove("trilyo-modal-box--visible"),c.modalBox.classList.remove(exitAnimation),c.modalOpenBtn&&c.modalOpenBtn.classList.remove(exitAnimation.replace("slide","move"))},q(c.opts.animationDuration))}else{var c=this;c.opts.parent.indexOf("trilyo-ab-")>-1&&c.modalBox.className.indexOf("trilyo-modal-box--visible")>-1&&(document.getElementById("trilyo-f-full").classList.remove("trilyo-modal-box--visible"),document.getElementById("trilyo-f-full").removeEventListener("mousedown",c._events.clickOverlay)),this.modalBox.classList.remove("trilyo-modal-box--visible")}var c=this;"function"!=typeof c.opts.onClose||a||c.opts.onClose(c.opts.campaign,c)};var q=function(a){console.log("cssStrings",a);var b=1;return a.length>2&&"ms"==a.substring(a.length-2).toLowerCase()?number=Number(a.substring(0,a.length-2)):(b=1e3,number=Number(a.substring(0,a.length-1))),number*b};return d.prototype.setContent=function(a){"string"==typeof a?this.modalBoxContent.innerHTML=a:(this.modalBoxContent.innerHTML="",this.modalBoxContent.appendChild(a)),this.isOpen()&&this.checkOverflow();var b=this,c=this.modalBox.querySelector("form .trilyo-btn--primary");if(c)c.addEventListener("click",function(a){if(a.preventDefault(),"function"==typeof b.opts.onFormSubmit){var c=b.modalBox.querySelector("form"),d=c.querySelectorAll(".trilyo-formcontrol"),f={};for(var g in d){d[g]&&d[g].classList&&d[g].classList.remove("trilyo-formcontrol-error");var h=d[g].classList;for(var i in h)if("string"==typeof h[i]&&-1==h[i].indexOf(" ")&&h[i].indexOf("trilyo-formcontrol")>-1&&h[i].length>18){var j=h[i].substring(19);if(console.log("fieldName",j),"checkbox"!=d[g].type&&"radio"!=d[g].type||(f[j]=e(b.modalBox,d[g].name)),"error"!=j){if(!(!d[g].hasAttribute("required")||d[g].value&&""!=d[g].value.trim()&&"on"!=d[g].value.trim()||f[j]&&0!=f[j].length))return void("checkbox"==d[g].type||"radio"==d[g].type?alert("Please choose one of the options before submitting"):d[g].classList.add("trilyo-formcontrol-error"));if(d[g].hasAttribute("data-validation")){var k=new RegExp(d[g].getAttribute("data-validation"));if(!k.test(d[g].value))return void d[g].classList.add("trilyo-formcontrol-error")}else f[j]||(f[j]=d[g].value||d[g].innerHTML)}}}b.opts.onFormSubmit(b,f)}});else{var d=this.modalBox.querySelector(".trilyo-btn--primary");d&&d.addEventListener("click",function(a){if("function"==typeof b.opts.onCTA){b.opts.onCTA(b)}})}var d=this.modalBox.querySelector(".trilyo-btn-allow");d&&d.addEventListener("click",function(a){if("function"==typeof b.opts.onCTA){b.opts.onCTA(b)}});var f=this.modalBox.querySelector(".trilyo-btn-close");f&&f.addEventListener("click",function(a){if("function"==typeof b.opts.onClose){b.opts.onClose(b.opts.campaign,b)}b.close()});var f=this.modalBox.querySelector(".trilyo-btn--default");f&&f.addEventListener("click",function(a){if("function"==typeof b.opts.onClose){b.opts.onClose(b.opts.campaign,b)}b.close()})},d.prototype.getContent=function(){return this.modalBoxContent},d.prototype.addFooter=function(){h.call(this)},d.prototype.hideFooter=function(){this.modalBoxFooter&&(this.modalBoxFooter.style.display="none")},d.prototype.showFooter=function(){this.modalBoxFooter.style.display="block"},d.prototype.setFooterContent=function(a){this.modalBoxFooter.innerHTML=a},d.prototype.getFooterContent=function(){return this.modalBoxFooter},d.prototype.setStickyFooter=function(a){this.isOverflow()||(a=!1),a?this.modalBox.contains(this.modalBoxFooter)&&(this.modalBox.removeChild(this.modalBoxFooter),this.modal.appendChild(this.modalBoxFooter),this.modalBoxFooter.classList.add("trilyo-modal-box__footer--sticky"),f.call(this),this.modalBoxContent.style["padding-bottom"]=this.modalBoxFooter.clientHeight+20+"px"):this.modalBoxFooter&&(this.modalBox.contains(this.modalBoxFooter)||(this.modal.removeChild(this.modalBoxFooter),this.modalBox.appendChild(this.modalBoxFooter),this.modalBoxFooter.style.width="auto",this.modalBoxFooter.style.left="",this.modalBoxContent.style["padding-bottom"]="",this.modalBoxFooter.classList.remove("trilyo-modal-box__footer--sticky")))},d.prototype.addFooterBtn=function(a,b,c,d){var e=document.createElement("button");e.innerHTML=a;var f=this;return e.addEventListener("click",function(){d&&d(c,f)}),"string"==typeof b&&b.length&&b.split(" ").forEach(function(a){e.classList.add(a)}),this.modalBoxFooter.appendChild(e),e},d.prototype.addShareBtn=function(a){var b=document.createElement("div"),c=a.split(" ");for(i=0;i<c.length;i++){var d=document.createElement("button");d.classList.add("trilyo-button--share"),d.classList.add(c[i]),b.appendChild(d)}this.modalBoxFooter.appendChild(b)},d.prototype.resize=function(){console.warn("Resize is deprecated and will be removed in version 1.0")},d.prototype.isOverflow=function(){var a=window.innerHeight;return this.modalBox.clientHeight>=a},d.prototype.checkOverflow=function(){this.modal&&this.modal.classList.contains("trilyo-modal--visible")&&(this.isOverflow()?this.modal.classList.add("trilyo-modal--overflow"):this.modal.classList.remove("trilyo-modal--overflow"),!this.isOverflow()&&this.opts.stickyFooter?this.setStickyFooter(!1):this.isOverflow()&&this.opts.stickyFooter&&(f.call(this),this.setStickyFooter(!0)))},d.prototype.setOnClick=function(a){var b=this;this.modal.addEventListener("click",function(c){if("function"==typeof a)try{-1==c.target.className.indexOf("trilyo-modal-box__close")&&a(b.opts.action,b)}catch(c){a(b.opts.action,b)}})},{modal:d,trigger:b}});